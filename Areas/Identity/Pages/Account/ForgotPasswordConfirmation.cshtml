@page
@model CRMWebApp.Areas.Identity.Pages.Account.ForgotPasswordConfirmationModel
@{
    ViewData["Title"] = "Password reset link sent";
}

<style>
    #alertBox.slide-up {
        overflow: hidden;
        transition: max-height .45s ease, opacity .45s ease, margin .45s ease, padding .45s ease, border-width .45s ease;
        max-height: 200px; 
    }

        #alertBox.slide-up.hide {
            max-height: 0;
            opacity: 0;
            margin: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            border-width: 0 !important;
        }
</style>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4 p-md-5 text-center">

                    @if (TempData["Message"] is string msg)
                    {
                        <div id="alertBox" class="alert alert-success alert-dismissible fade show text-start slide-up" role="alert">
                            @msg
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                         style="width:64px;height:64px;background:#eef5ff;">
                        <svg xmlns="http:                             class="bi bi-envelope" viewBox="0 0 16 16" style="color:#0d6efd">
                            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v.217l-8 4.8-8-4.8z" />
                            <path d="M0 5.383v6.234L5.803 8.48 0 5.383zM6.761 9.021l-6.53 3.918A2 2 0 0 0 2 14h12a2 2 0 0 0 1.77-1.061l-6.53-3.918-.24.144-.239-.144zM10.197 8.48 16 11.617V5.383л-5.803 3.097z" />
                        </svg>
                    </div>

                    <h1 class="h4 fw-bold mb-2">Password reset link sent</h1>
                    <p class="text-secondary mb-4">
                        We’ve sent a link to your email address to reset your password.
                    </p>

                    <form method="post" class="d-inline">
                        <input type="hidden" asp-for="Email" />
                        <button id="resendBtn"
                                type="submit"
                                class="btn btn-primary"
                                disabled="@(Model.CooldownSeconds > 0 ? "disabled" : null)"
                                data-remaining="@Model.CooldownSeconds">
                            @(Model.CooldownSeconds > 0 ? $"Resend link (in {Model.CooldownSeconds}s)" : "Resend link")
                        </button>
                    </form>
                </div>
            </div>

            <div class="text-center mt-3 small text-muted">
                &copy; @DateTime.UtcNow.Year - CRMWebApp
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
                        const alertBox = document.getElementById('alertBox');
            if (alertBox) {
                setTimeout(() => {
                                        alertBox.classList.remove("show");
                    alertBox.classList.add("hide");
                                        alertBox.addEventListener('transitionend', () => alertBox.remove(), { once: true });
                }, 3000);             }

                        const btn = document.getElementById('resendBtn');
            if (btn) {
                let remaining = parseInt(btn.dataset.remaining || "0", 10);
                if (remaining > 0) {
                    const tick = () => {
                        remaining--;
                        if (remaining > 0) {
                            btn.textContent = `Resend link (in ${remaining}s)`;
                            btn.setAttribute('disabled', 'disabled');
                            setTimeout(tick, 1000);
                        } else {
                            btn.textContent = 'Resend link';
                            btn.removeAttribute('disabled');
                        }
                    };
                    setTimeout(tick, 1000);
                }
            }
        })();
    </script>
}
