@model IEnumerable<CRMWebApp.Pages.Deals.IndexModel.Row>
@using CRMWebApp.Models

@if (!Model.Any())
{
    <tr>
        <td colspan="9" class="text-center text-muted">No deals found.</td>
    </tr>
}
else
{
    foreach (var row in Model)
    {
        var item = row.Item;
        <tr>
            <td>@item.Title</td>
            <td>@(item.Client?.Name ?? $"Client #{item.ClientId}")</td>
            <td>
                @{
                    var badge = item.Status switch
                    {
                        DealStatus.InProgress => "badge bg-info",
                        DealStatus.Successful => "badge bg-success",
                        DealStatus.Failed => "badge bg-danger",
                        _ => "badge bg-secondary"
                    };
                    var text = item.Status switch
                    {
                        DealStatus.InProgress => "In Progress",
                        DealStatus.Successful => "Successful",
                        DealStatus.Failed => "Failed",
                        _ => item.Status.ToString()
                    };
                }
                <span class="@badge">@text</span>
            </td>
            <td>@item.Amount.ToString("N2")</td>
            <td>@item.Currency</td>

            <td>
                <partial name="_ProbabilityBadge" model="item.Probability" />
            </td>

            <td>@(item.CloseDate?.ToString("yyyy-MM-dd"))</td>
            <td>@(string.IsNullOrWhiteSpace(item.Notes) ? "—" : item.Notes)</td>

            <td class="actions-col">
                <div class="d-flex">

                    @if (row.CanEdit)
                    {
                        <a asp-page="./Edit" asp-route-id="@item.Id" class="btn btn-edit">Edit</a>
                    }
                    else
                    {
                        <a role="button" class="btn btn-edit disabled" aria-disabled="true" tabindex="-1" style="pointer-events:none">Edit</a>
                    }

                    <a asp-page="./Details" asp-route-id="@item.Id" class="btn btn-details">Details</a>

                    @if (row.CanDelete)
                    {
                        <a asp-page="./Delete" asp-route-id="@item.Id" class="btn btn-delete">Delete</a>
                    }
                    else
                    {
                        <a role="button" class="btn btn-delete disabled" aria-disabled="true" tabindex="-1" style="pointer-events:none">Delete</a>
                    }
                </div>
            </td>
        </tr>
    }
}
